{% load static %}
{% load custom_filters %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detail Page</title>
    <link rel="stylesheet" type="text/css" href="{% static 'track_detail/style.css' %}">
  </head>
  <body>
    <div id="detail-page">
      <div class="w-screen h-screen flex justify-center">
        <div class="w-screen h-screen flex justify-center">
          <div
            class="w-screen h-screen bg-gradient-to-br from-gray-900 via-neutral-900 to-zinc-900 flex"
          >
            <nav
              class="hidden md:block w-[240px] bg-gray-800/30 backdrop-blur-lg p-6 relative border-r border-gray-700/30"
            >
              <div class="mb-8 flex items-center justify-center">
                <div class="relative w-32 h-32 group">
                  <div
                    class="absolute inset-0 bg-gradient-to-r from-gray-500 to-zinc-600 rounded-full blur-lg group-hover:blur-xl transition-all duration-300 opacity-50"
                  ></div>
                  <div
                    class="relative bg-gray-900 rounded-full w-full h-full flex items-center justify-center border-2 border-gray-500/30 group-hover:scale-105 transition-all duration-300"
                  >
                    <span
                      class="text-3xl font-bold bg-gradient-to-r from-gray-300 to-zinc-400 bg-clip-text text-transparent"
                      >AIMUZ</span
                    >
                  </div>
                </div>
              </div>
              <ul class="space-y-6 text-gray-300">
                <li
                  class="flex items-center gap-3 hover:text-gray-100 hover:translate-x-1 transition-all duration-200 cursor-pointer"
                >
                  <span class="material-symbols-outlined">home</span>
                  <a href="{% url 'main_page' %}">
                  <span>Главная страница</span>
                    </a>
                </li>
                <li
                  class="flex items-center gap-3 hover:text-gray-100 hover:translate-x-1 transition-all duration-200 cursor-pointer"
                >
                  <span class="material-symbols-outlined">add_box</span>
                  <a href="{% url 'music_page' %}">
                  <span>Создать</span>
                    </a>
                </li>
                <li
                  class="flex items-center gap-3 hover:text-gray-100 hover:translate-x-1 transition-all duration-200 cursor-pointer"
                >
                  <span class="material-symbols-outlined">library_music</span>
                  <a href="{% url 'library_page' %}">
                  <span>Библиотека</span>
                    </a>
                </li>
                <li
                  class="flex items-center gap-3 hover:text-gray-100 hover:translate-x-1 transition-all duration-200 cursor-pointer"
                >
                  <span class="material-symbols-outlined">person</span>
                  <a href="{% url 'profile_view' %}">
                  <span>Профиль</span>
                    </a>
                </li>
              </ul>
            </nav>
            <main class="flex-1 p-8 overflow-y-auto relative">
              <div class="md:hidden flex justify-between items-center mb-6">
                <div class="relative w-10 h-10 group">
                  <div
                    class="absolute inset-0 bg-gradient-to-r from-gray-500 to-zinc-600 rounded-full blur-lg group-hover:blur-xl transition-all duration-300 opacity-50"
                  ></div>
                  <div
                    class="relative bg-gray-900 rounded-full w-full h-full flex items-center justify-center border-2 border-gray-500/30 group-hover:scale-105 transition-all duration-300"
                  >
                    <span
                      class="text-sm font-bold bg-gradient-to-r from-gray-300 to-zinc-400 bg-clip-text text-transparent"
                      >AI</span
                    >
                  </div>
                </div>
                <details class="relative">
                  <summary class="list-none">
                    <a href="{% url 'profile_view' %}">
                    <div
                      class="w-10 h-10 bg-gray-800/50 rounded-full flex items-center justify-center cursor-pointer hover:bg-gray-700/50 transition-colors"
                    >
                      <span class="material-symbols-outlined text-gray-300"
                        >person</span
                      >
                    </div>
                    </a>
                  </summary>

                </details>
              </div>
              <div class="flex flex-col md:flex-row gap-8">
                <div class="md:w-1/2">
                  <div class="relative group cursor-pointer mb-6">
                    <img
                      src="{{ image_url }}"
                      class="w-full aspect-square object-cover rounded-2xl"
                      alt="{{ title }}"
                    />
                    <button
                      class="absolute inset-0 m-auto w-20 h-20 bg-gradient-to-r from-gray-500 to-zinc-600 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300 hover:from-gray-600 hover:to-zinc-700 hover:scale-110"
                    >
                      <span
                        class="material-symbols-outlined text-gray-200 text-4xl"
                        >play_arrow</span
                      >
                    </button>
                  </div>
                  <div class="flex items-center justify-between mb-6">
                    <div>
                      <h1 class="text-3xl font-bold mb-2 text-gray-200">
                        {{ title }}
                      </h1>
                      <p class="text-gray-400">{{ artist }}</p>
                    </div>
                    <div class="flex gap-4">
                      <button
                          class="w-12 h-12 bg-gray-800/50 rounded-full flex items-center justify-center hover:bg-gray-700/50 transition-colors"
                          onclick="toggleLike({{ track.id }})"
                          id="like-button-{{ track.id }}"
                      >
                          <span id="like-icon-{{ track.id }}" class="material-symbols-outlined text-gray-300">
                              favorite_border
                          </span>
                      </button>
                      <button
                              onclick="shareTrack()"
                        class="w-12 h-12 bg-gray-800/50 rounded-full flex items-center justify-center hover:bg-gray-700/50 transition-colors"
                      >
                        <span class="material-symbols-outlined text-gray-300"
                          >share</span
                        >
                      </button>
                    </div>
                  </div>
                  <div class="space-y-6">
                    <div class="flex items-center gap-4">
                      <span
                        class="bg-gray-700/30 backdrop-blur-sm px-3 py-1 rounded-full text-gray-300 hover:bg-gray-600/30 transition-colors cursor-pointer"
                        >{{ genre }}</span
                      >
                      <span class="text-gray-400">Released: {{ release_date }}</span>
                    </div>
                    <div class="space-y-4">
                      <div class="flex justify-between text-gray-300">
                        <span ><span id="like-count-{{ track.id }}">{{ likes_count }}</span> likes</span> <span>{{ listens_count }} plays</span>
                      </div>
                      <div
                        class="h-1 bg-gray-700/50 rounded-full overflow-hidden"
                      >
                        <div
                          class="w-2/3 h-full bg-gradient-to-r from-gray-500 to-zinc-600"
                        ></div>
                      </div>
                    </div>
                  </div>
                  <div class="mt-8 bg-gray-800/30 backdrop-blur-lg rounded-xl p-6">
  <div class="flex items-center justify-between mb-4">
    <div class="flex items-center gap-4">
      <button
        onclick="skipPrevious()"
        class="w-12 h-12 bg-gray-700/50 rounded-full flex items-center justify-center hover:bg-gray-600/50 transition-colors">
        <span class="material-symbols-outlined text-gray-300">skip_previous</span>
      </button>
      <button
        onclick="togglePlayPause()"
        class="w-16 h-16 bg-gradient-to-r from-gray-500 to-zinc-600 rounded-full flex items-center justify-center hover:from-gray-600 hover:to-zinc-700 transition-colors">
        <span id="detail-play-icon" class="material-symbols-outlined text-gray-200 text-3xl">play_arrow</span>
      </button>
      <button
        onclick="skipNext()"
        class="w-12 h-12 bg-gray-700/50 rounded-full flex items-center justify-center hover:bg-gray-600/50 transition-colors">
        <span class="material-symbols-outlined text-gray-300">skip_next</span>
      </button>
    </div>
    <div class="flex items-center gap-4">
      <button
        class="w-10 h-10 bg-gray-700/50 rounded-full flex items-center justify-center hover:bg-gray-600/50 transition-colors">
        <span class="material-symbols-outlined text-gray-300">repeat</span>
      </button>
      <button
        class="w-10 h-10 bg-gray-700/50 rounded-full flex items-center justify-center hover:bg-gray-600/50 transition-colors">
        <span class="material-symbols-outlined text-gray-300">shuffle</span>
      </button>
    </div>
  </div>
  <div class="space-y-2">
    <div class="flex items-center gap-4">
      <span class="text-gray-400 text-sm" id="current-time">0:00</span>
      <div class="flex-1 h-1 bg-gray-700/50 rounded-full overflow-hidden cursor-pointer" onclick="seekAudio(event)">
        <div id="progress-bar" class="w-0 h-full bg-gradient-to-r from-gray-500 to-zinc-600 relative">
          <div class="absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 bg-gray-200 rounded-full"></div>
        </div>
      </div>
      <span class="text-gray-400 text-sm" id="total-duration">0:00</span>
    </div>
    <div class="flex items-center gap-4">
      <span class="material-symbols-outlined text-gray-300">volume_up</span>
      <input type="range" min="0" max="1" step="0.01" value="0.8" id="volume-control" onchange="setVolume(this.value)" class="w-full">
    </div>
  </div>
</div>

                </div>
                <div class="md:w-1/2 space-y-8">
                  <div class="bg-gray-800/30 backdrop-blur-lg rounded-xl p-6">
                    <h2 class="text-xl font-bold mb-4 text-gray-200">
                      Description
                    </h2>
                     {% for line in lyrics %}
                        <p class="text-gray-300 leading-relaxed">{{ line }}</p>
                      {% endfor %}
                  </div>
                </div>
              </div>
              <br><br><br><br><br><br>
            </main>
            <nav
              class="md:hidden absolute bottom-0 left-0 right-0 h-16 bg-gray-800/90 backdrop-blur-lg border-t border-gray-700/30 flex items-center justify-around"
            >
              <button
                class="w-12 h-12 flex items-center justify-center text-gray-300 hover:text-gray-100"
              >
                <a href="{% url 'main_page' %}">
                <span class="material-symbols-outlined">home</span>
                  </a>
              </button>
              <button
                class="w-12 h-12 flex items-center justify-center text-gray-300 hover:text-gray-100"
              >
                <a href="{% url 'music_page' %}">
                <span class="material-symbols-outlined">add_box</span>
                  </a>
              </button>
              <button
                class="w-12 h-12 flex items-center justify-center text-gray-300 hover:text-gray-100"
              >
                <a href="{% url 'library_page' %}">
                <span class="material-symbols-outlined">library_music</span>
                  </a>
              </button>
              <button
                class="w-12 h-12 flex items-center justify-center text-gray-300 hover:text-gray-100"
              >
                <a href="{% url 'profile_view' %}">
                <span class="material-symbols-outlined">person</span>
                  </a>
              </button>
            </nav>
          </div>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
    setAudioSource("{{ audio_url }}");
  });
      let audioPlayer = new Audio();
let isPlaying = false;

function togglePlayPause() {
  const playIcon = document.getElementById('detail-play-icon');
  if (audioPlayer.paused) {
    audioPlayer.play();
    isPlaying = true;
    playIcon.innerText = 'pause';
  } else {
    audioPlayer.pause();
    isPlaying = false;
    playIcon.innerText = 'play_arrow';
  }
}

function setAudioSource(url) {
  audioPlayer.src = url;
  audioPlayer.load();
  audioPlayer.play();
  isPlaying = true;
}

audioPlayer.ontimeupdate = function() {
  updateProgressBar();
  document.getElementById('current-time').innerText = formatTime(audioPlayer.currentTime);
  document.getElementById('total-duration').innerText = formatTime(audioPlayer.duration || 0);
};

audioPlayer.onended = function() {
  isPlaying = false;
  document.getElementById('detail-play-icon').innerText = 'play_arrow';
};

function updateProgressBar() {
  const progressBar = document.getElementById('progress-bar');
  const percentage = (audioPlayer.currentTime / audioPlayer.duration) * 100;
  progressBar.style.width = percentage + '%';
}

function seekAudio(event) {
  const bar = event.currentTarget;
  const clickPosition = event.offsetX / bar.clientWidth;
  audioPlayer.currentTime = clickPosition * audioPlayer.duration;
}

function setVolume(value) {
  audioPlayer.volume = value;
}

function skipPrevious() {
  audioPlayer.currentTime = 0;
  audioPlayer.play();
}

function skipNext() {
  audioPlayer.currentTime = audioPlayer.duration;
}

function formatTime(seconds) {
  const minutes = Math.floor(seconds / 60);
  const secs = Math.floor(seconds % 60).toString().padStart(2, '0');
  return `${minutes}:${secs}`;
}
function toggleLike(trackId) {
  fetch(`/toggle-like/${trackId}/`)
    .then(response => response.json())
    .then(data => {
      const icon = document.getElementById(`like-icon-${trackId}`);
      const countSpan = document.getElementById(`like-count-${trackId}`);

      if (data.liked) {
        icon.innerText = 'favorite'; // заполненное сердечко
        icon.classList.add('text-red-500');
      } else {
        icon.innerText = 'favorite_border'; // пустое сердечко
        icon.classList.remove('text-red-500');
      }
      countSpan.innerText = data.likes_count;
    });
}
function shareTrack() {
  const trackUrl = window.location.href;
  navigator.clipboard.writeText(trackUrl)
    .then(() => {
      alert('Ссылка скопирована в буфер обмена!');
    })
    .catch(err => console.error('Ошибка копирования:', err));
}


    </script>
  </body>
</html>